============
Placeholders
============

Transifex supports adding
`Translation checks <https://help.transifex.com/en/articles/6241794-setting-translation-checks#h_317a8b70f5>`_
to fit the translation caracteristics.

Adding custom placeholders causes the matched expression to be highlighted, be assigned unique numbers in that string,
and to be warned if translation differs from the source string.

Some notes:
    - Some roles allow being renamed (e.g. "\:ref:\`this is a rename text <actual-link>\`_"), and the renamed text
      has great chance of being translatable. Hence, these roles that have whitespaces were not added to the list
      of place holders, and will be rendered as normal text.
    - The roles :dfn: and :term: were not included because their content are normally translatable, so making them
      placeholders would pop up too many false-positive warnings.
    - \``$\`` is being wrongly replaced with the placeholder ```{TX-PL-LABEL}#x60;``` by Transifex because of the 
      custom placeholder that starts and ends with \``. Removing this custom placeholder ceases the issue, but it
      disables custom placeholders for all literal expressions.

Get a list of potential placeholders
------------------------------------

One way to create a list of placeholders is to navigate through a bunch of translation files (po file) or translation
templates (pot files) with the proper regular expression pattern.

    **NOTE:** The commands below are set to be run from the root directory of a language team's repository, or from CPython's Docs directory after generating pot files (directory cpython/Doc/locales/pot).

To list two-part roles (e.g. :py:data:\`) and then one-part roles (e.g. :class:\`), each output ordered by number of occurence:

.. code-block:: shell
   
   grep -R '^msgid ' | grep -Poh '(\s\")?:[\w]+:[\w]+:`[\w\.-_\s~]+([\s]+<[\w\.-_]+>)?`' | sed 's| ":|:|' | cut -d\` -f1 | sort | uniq -c | sort -grk 1
   grep -R '^msgid ' | grep -Poh '(\s\")?:[\w]+:`[\w\.-_\s~]+([\s]+<[\w\.-_]+>)?`' | sed 's| ":|:|' | cut -d\` -f1 | sort | uniq -c | sort -grk 1

I split in two commands because two-part roles must be added as custom placeholder before one-part roles (explained below), hence this command helps making sure the priority is correct for copy and pasting into custom placeholders.

To list Sphinx variables (e.g. \|version\|):

.. code-block:: shell

   grep -ERI '[^a-zA-Z]\|[a-zA-Z]+\|[^a-zA-Z]' | grep -Eo '\|[a-zA-Z]+\|_?' | sort -u

The above command find occurrences of text within pipes excluding text outside the pip, and then use '-o' flag to match-only the wanted content. Finally, it sorts excluding duplicated occurrences. This should give you only the Sphinx variables.

Current Custom Placeholders
---------------------------

This is the list of roles and variables currently set in python-doc organization in Transifex.

+---------------+--------------+---------------------+--------------------------------------------------------------------+
| Starts with   | Ends with    | Allows whitespace   | Note                                                               |
+===============+==============+=====================+====================================================================+
| :c:data:\`    | \`           | no                  | Here start two-part roles. These **must** be inserted before       |
|               |              |                     | one-part roles because Transifex placeholders are detected         |
|               |              |                     | according to their order; otherwise one-part role will match       |
|               |              |                     | when not wanted (e.g. the ":data:\`" will excluding the ":c:")     |
+---------------+--------------+---------------------+--------------------------------------------------------------------+
| :c:expr:\`    | \`           | no                  |                                                                    |
+---------------+--------------+---------------------+--------------------------------------------------------------------+
| :c:func:\`    | \`           | no                  |                                                                    |
+---------------+--------------+---------------------+--------------------------------------------------------------------+
| :c:macro:\`   | \`           | no                  |                                                                    |
+---------------+--------------+---------------------+--------------------------------------------------------------------+
| :c:member:\`  | \`           | no                  |                                                                    |
+---------------+--------------+---------------------+--------------------------------------------------------------------+
| :c:struct:\`  | \`           | no                  |                                                                    |
+---------------+--------------+---------------------+--------------------------------------------------------------------+
| :c:type:\`    | \`           | no                  |                                                                    |
+---------------+--------------+---------------------+--------------------------------------------------------------------+
| :c:var:\`     | \`           | no                  |                                                                    |
+---------------+--------------+---------------------+--------------------------------------------------------------------+
| :py:attr:\`   | \`           | no                  |                                                                    |
+---------------+--------------+---------------------+--------------------------------------------------------------------+
| :py:class:\`  | \`           | no                  |                                                                    |
+---------------+--------------+---------------------+--------------------------------------------------------------------+
| :py:data:\`   | \`           | no                  |                                                                    |
+---------------+--------------+---------------------+--------------------------------------------------------------------+
| :py:func:\`   | \`           | no                  |                                                                    |
+---------------+--------------+---------------------+--------------------------------------------------------------------+
| :py:meth:\`   | \`           | no                  |                                                                    |
+---------------+--------------+---------------------+--------------------------------------------------------------------+
| :py:mod:\`    | \`           | no                  |                                                                    |
+---------------+--------------+---------------------+--------------------------------------------------------------------+
| :2to3fixer:\` | \`           | no                  |                                                                    |
+---------------+--------------+---------------------+--------------------------------------------------------------------+
| :abbr:\`      | \`           | no                  | Here start the one-part roles.                                     |
+---------------+--------------+---------------------+--------------------------------------------------------------------+
| :attr:\`      | \`           | no                  |                                                                    |
+---------------+--------------+---------------------+--------------------------------------------------------------------+
| :class:\`     | \`           | no                  |                                                                    |
+---------------+--------------+---------------------+--------------------------------------------------------------------+
| :code:\`      | \`           | no                  |                                                                    |
+---------------+--------------+---------------------+--------------------------------------------------------------------+
| :command:\`   | \`           | no                  |                                                                    |
+---------------+--------------+---------------------+--------------------------------------------------------------------+
| :const:\`     | \`           | no                  |                                                                    |
+---------------+--------------+---------------------+--------------------------------------------------------------------+
| :data:\`      | \`           | no                  |                                                                    |
+---------------+--------------+---------------------+--------------------------------------------------------------------+
| :doc:\`       | \`           | no                  |                                                                    |
+---------------+--------------+---------------------+--------------------------------------------------------------------+
| :download:\`  | \`           | no                  |                                                                    |
+---------------+--------------+---------------------+--------------------------------------------------------------------+
| :envvar:\`    | \`           | no                  |                                                                    |
+---------------+--------------+---------------------+--------------------------------------------------------------------+
| :exc:\`       | \`           | no                  |                                                                    |
+---------------+--------------+---------------------+--------------------------------------------------------------------+
| :expr:\`      | \`           | no                  |                                                                    |
+---------------+--------------+---------------------+--------------------------------------------------------------------+
| :file:\`      | \`           | no                  |                                                                    |
+---------------+--------------+---------------------+--------------------------------------------------------------------+
| :func:\`      | \`           | no                  |                                                                    |
+---------------+--------------+---------------------+--------------------------------------------------------------------+
| :gh:\`        | \`           | no                  |                                                                    |
+---------------+--------------+---------------------+--------------------------------------------------------------------+
| :guilabel:\`  | \`           | no                  |                                                                    |
+---------------+--------------+---------------------+--------------------------------------------------------------------+
| :issue:\`     | \`           | no                  |                                                                    |
+---------------+--------------+---------------------+--------------------------------------------------------------------+
| :kbd:\`       | \`           | no                  |                                                                    |
+---------------+--------------+---------------------+--------------------------------------------------------------------+
| :keyword:\`   | \`           | no                  |                                                                    |
+---------------+--------------+---------------------+--------------------------------------------------------------------+
| :macro:\`     | \`           | no                  |                                                                    |
+---------------+--------------+---------------------+--------------------------------------------------------------------+
| :mailheader:\`| \`           | no                  |                                                                    |
+---------------+--------------+---------------------+--------------------------------------------------------------------+
| :makevar:\`   | \`           | no                  |                                                                    |
+---------------+--------------+---------------------+--------------------------------------------------------------------+
| :member:\`    | \`           | no                  |                                                                    |
+---------------+--------------+---------------------+--------------------------------------------------------------------+
| :meth:\`      | \`           | no                  |                                                                    |
+---------------+--------------+---------------------+--------------------------------------------------------------------+
| :mimetype:\`  | \`           | no                  |                                                                    |
+---------------+--------------+---------------------+--------------------------------------------------------------------+
| :mod:\`       | \`           | no                  |                                                                    |
+---------------+--------------+---------------------+--------------------------------------------------------------------+
| :newsgroup:\` | \`           | no                  |                                                                    |
+---------------+--------------+---------------------+--------------------------------------------------------------------+
| :opcode:\`    | \`           | no                  |                                                                    |
+---------------+--------------+---------------------+--------------------------------------------------------------------+
| :pdbcmd:\`    | \`           | no                  |                                                                    |
+---------------+--------------+---------------------+--------------------------------------------------------------------+
| :pep:\`       | \`           | no                  |                                                                    |
+---------------+--------------+---------------------+--------------------------------------------------------------------+
| :program:\`   | \`           | no                  |                                                                    |
+---------------+--------------+---------------------+--------------------------------------------------------------------+
| :ref:\`       | \`           | no                  |                                                                    |
+---------------+--------------+---------------------+--------------------------------------------------------------------+
| :rfc:\`       | \`           | no                  |                                                                    |
+---------------+--------------+---------------------+--------------------------------------------------------------------+
| :source:\`    | \`           | no                  |                                                                    |
+---------------+--------------+---------------------+--------------------------------------------------------------------+
| :struct:\`    | \`           | no                  |                                                                    |
+---------------+--------------+---------------------+--------------------------------------------------------------------+
| :sub:\`       | \`           | no                  |                                                                    |
+---------------+--------------+---------------------+--------------------------------------------------------------------+
| :sup:\`       | \`           | no                  |                                                                    |
+---------------+--------------+---------------------+--------------------------------------------------------------------+
| :type:\`      | \`           | no                  |                                                                    |
+---------------+--------------+---------------------+--------------------------------------------------------------------+
| :var:\`       | \`           | no                  |                                                                    |
+---------------+--------------+---------------------+--------------------------------------------------------------------+
| :manpage:\`   | \`           | no                  |                                                                    |
+---------------+--------------+---------------------+--------------------------------------------------------------------+
| :option:\`    | \`           | no                  |                                                                    |
+---------------+--------------+---------------------+--------------------------------------------------------------------+
| :option:\--`  | \`           | no                  |                                                                    |
+---------------+--------------+---------------------+--------------------------------------------------------------------+
| :option:\-`   | \`           | no                  |                                                                    |
+---------------+--------------+---------------------+--------------------------------------------------------------------+
| \``--         | \``          | no                  | This is literal role to match double-dash command-line options.    |
|               |              |                     | Must come before single-dash one because Transifex placeholders    |
|               |              |                     | are detected according to their order.                             |
+---------------+--------------+---------------------+--------------------------------------------------------------------+
| \``-          | \``          | no                  | This is literal role to match single-dash command-line options.    |
+---------------+--------------+---------------------+--------------------------------------------------------------------+
| \``           | \``          | yes                 | This matches all literals, and spaces should be allowed.           |
+---------------+--------------+---------------------+--------------------------------------------------------------------+
| \|nbs         | \|           | no                  | Here start Sphinx variables.                                       |
|               |              |                     | This is for '\|nbsp\|'.                                            |
|               |              |                     | Since Transifex doesn't allow adding the whole variable as         |
|               |              |                     | placeholder, I omit the last character of the variable as a        |
|               |              |                     | workaround                                                         |
+---------------+--------------+---------------------+--------------------------------------------------------------------+
| \|releas      | \|           | no                  | This is for '\|release\|'                                          |
+---------------+--------------+---------------------+--------------------------------------------------------------------+
| \|toda        | \|           | no                  | This is for '\|today\|'                                            |
+---------------+--------------+---------------------+--------------------------------------------------------------------+
| \|tzdat       | \|_          | no                  | This is for '\|tzdata\|_'. This variable is used as a URL, hence   |
|               |              |                     | the trailing '_'                                                   |
+---------------+--------------+---------------------+--------------------------------------------------------------------+
| \|versio      | \|           | no                  | This is for '\|version\|'                                          |
+---------------+--------------+---------------------+--------------------------------------------------------------------+
| :samp:\`      | \`           | yes                 | Inserted later, out-of-order, this role normally present shell     |
|               |              |                     | commands and as such normally includes whitespaces. It may include |
|               |              |                     | pseudo-variables that should be translated.                        |
+---------------+--------------+---------------------+--------------------------------------------------------------------+
